<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Iniciar Sesión | NUTRILIFE</title>
    <link rel="stylesheet" href="/NutriLife/CSS/login.css">
    <script>
        function validarLogin(event) {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (email === '' || password === '') {
                alert('Debe ingresar su correo electrónico y su contraseña.');
                event.preventDefault();
                return false;
            }
            return true;
        }

        function toggleRecoveryForm() {
            var form = document.getElementById('recover-form');
            var link = document.getElementById('recover-toggle');
            if (form.style.display === 'none' || form.style.display === '') {
                form.style.display = 'block';
                link.textContent = 'Cancelar solicitud';
            } else {
                form.style.display = 'none';
                link.textContent = '¿Olvidaste tu contraseña?';
            }
        }
    </script>
</head>

<body>
<h1><strong>NUTRILIFE</strong></h1>

<div id="form-container">
    <h2>Iniciar Sesión</h2>

    <p id="error-message" style="color: red; font-weight: bold; text-align: center;"></p>

    <form method="post" action="../../PHP/procesar_login.php" onsubmit="return validarLogin(event)">

        <p><label>Email:
            <input type="email" id="email" name="email" required placeholder="nombre@dominio.com" />
        </label></p>

        <p><label>Contraseña:
            <input type="password" id="password" name="password" required placeholder="Contraseña"/>
        </label></p>

        <p style="text-align: center; margin-top: 25px;">
            <input type="submit" value="Acceder" />
        </p>
    </form>

    <a href="#" id="recover-toggle" onclick="toggleRecoveryForm()">¿Olvidaste tu contraseña?</a>

    <form method="post" action="../../PHP/solicitar_recuperacion.php" id="recover-form" style="display: none;">
        <h3>Recuperar Contraseña</h3>
        <p style="font-size: 0.8em; margin-bottom: 10px;">Ingrese su email para recibir el enlace de restablecimiento.</p>

        <p><label>Email de Cuenta:</label>
            <input type="email" name="email" required /></p>

        <p style="text-align: center;">
            <input type="submit" value="Solicitar Enlace" style="background-color: #dc3545; color: white; padding: 8px 15px; border: none; cursor: pointer;" />
        </p>
    </form>

</div>

<script>
    // Script para leer y mostrar mensajes de error/sesión cerrada de la URL
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const msg = urlParams.get('msg');
        const errorDiv = document.getElementById('error-message');

        if (msg && errorDiv) {
            errorDiv.textContent = decodeURIComponent(msg);

            // Limpiar la URL después de mostrar el mensaje
            if (window.history.replaceState) {
                window.history.replaceState(null, '', window.location.pathname);
            }
        }
    });
</script>
</body>
</html>